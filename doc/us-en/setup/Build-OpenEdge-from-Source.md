# Build OpenEdge From Source

## Environment Configuration On Linux

### Install Go Programming Language

Go to [related resources](../Resources-download.md) to complete the download, then:

```shell
tar -C /usr/local -zxf go$VERSION.$OS-$ARCH.tar.gz  # Decompress the Go archive to the /usr/local directory
export PATH=$PATH:/usr/local/go/bin # Configuring environment variables
export GOPATH=yourpath  # GOPATH setting
go env  # View Go's environment variables
go version # View Go's version
```

_**NOTE**: OpenEdge requires that the compiled version of Go be above 1.10.0 ._

### Install Docker

- The official Dockerfile is offered for multi-stage builds. If you need to build the relevant image yourself, The version of docker you installed should be above 17.05;
- According to the [Official Release Log](https://docs.docker.com/engine/release-notes/#18092), the version of Docker lower than 18.09.2 has some security implications. It is recommended to install/update the Docker to 18.09.2 and above.

Can be installed by the following command(Suitable for linux-like systems, [Supported Platforms](./Support-platforms.md)):

```shell
curl -sSL https://get.docker.com | sh
```

#### Ubuntu

Command:

```shell
sudo snap install docker # Ubuntu16.04 after
sudo apt-get install docker.io # Ubuntu 16.04 before
```

#### CentOS

Command:

```shell
yum install docker
```

**NOTE**: After the Docker installation is complete, use the following command to view the installed version of Docker.

```shell
docker version
```

#### Debian 9/Raspberry Pi 3

Command:

```shell
curl -sSL https://get.docker.com | sh
```

**For more details, please see the [official documentation](https://docs.docker.com/install/).**

## Environment Configuration On Darwin

### Install Go

+ Install by using HomeBrew

```shell
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"  # install homebrew
brew install go
```

Modify the environment configuration file after the installation is complete.(e.g: ~/.bash_profile)：

```shell
export GOPATH="${HOME}/go"
export GOROOT="$(brew --prefix golang)/libexec"
export PATH="$PATH:${GOPATH}/bin:${GOROOT}/bin"
```

Make the environment variable take effect:

```shell
source yourfile
```

Create the GOPATH specified directory:

```shell
test -d "${GOPATH}" || mkdir "${GOPATH}"
```

+ Install by using binary file

Go to [related resources](../Resources-download.md) to complete the download, then:

```shell
tar -C /usr/local -zxf go$VERSION.$OS-$ARCH.tar.gz  # Decompress the Go archive to the /usr/local directory
export PATH=$PATH:/usr/local/go/bin # Configuring environment variables
export GOPATH=yourpath  # GOPATH setting
go env  # View Go's environment variables
go version # View Go's version
```

_**NOTE**: OpenEdge requires that the compiled version of Go be above 1.10.0 ._

### Install Docker

Go to [official page](https://hub.docker.com/editions/community/docker-ce-desktop-mac) to download the .dmg file you need. Once done, double-click to open and drag Docker into the Application folder.

![Install On Darwin](../../images/setup/docker-install-on-mac.png)

View the version of installed Docker:

```shell
docker version
```

## Download Source Code

After completing the compilation environment configuration according to the corresponding environment, go to the [OpenEdge Github Page](https://github.com/baidu/openedge) to download source code of openedge.

```shell
go get github.com/baidu/openedge
```

## Compile the Source Code

```shell
cd $GOPATH/src/github.com/baidu/openedge
make # Compile
```

After the compilation is completed, the following five executable files will be generated in the root directory and each module directory, respectively:

```shell
openedge
openedge-agent/openedge-agent
openedge-hub/openedge-hub
openedge-function-manager/openedge-function-manager
openedge-remote-mqtt/openedge-remote-mqtt
```

In addition, a total of five files named `package.zip` are generated in each module directory.

If you built the executable files for different platform, you need to execute following command before build images for specify platform:

```shell
env GOOS=linux GOARCH=amd64 make rebuild
```

Or you can clean past files by execute command `make clean`.

```shell
env GOOS=linux GOARCH=amd64 make image # build the images
```

**NOTE**: The values of `GOOS` and `GOARCH` need to be modified to the corresponding system type and CPU architecture. In particular, under darwin system, `GOOS` and `GOARCH` are still linux and amd64 respectively.

The following five images are generated by the above command:

```shell
openedge-agent:latest
openedge-hub:latest
openedge-function-manager:latest
openedge-remote-mqtt:latest
openedge-function-python27:latest
```

View the generated images with the following command:

```shell
docker images
```

## Install OpenEdge

Install to default path: /usr/local。

```shell
cd $GOPATH/src/github.com/baidu/openedge
make install # install for docker mode with example configuration
make install-native # install for native mode with example configuration
```

Specify the installation path, such as installing into the output directory:

```shell
cd $GOPATH/src/github.com/baidu/openedge
make install PREFIX=output
```

## Run the OpenEdge

If the program is already installed to the default path: /usr/local。

```shell
sudo openedge start
```

If the program has been installed to the specified path, such as installing into the output directory:

```shell
cd $GOPATH/src/github.com/baidu/openedge
sudo ./output/bin/openedge start
```

**NOTE**: The startup method varies depending on the installation method. That is, if you choose Docker mode installation, the above command will run OpenEdge in Docker container mode.

**NOTE**:

1. After the openedge is started, you can check if the openedge has run successfully by `ps -ef | grep "openedge"` and determine the parameters used at startup. And you can check the log file for details. Log files are stored by default in the `var/log/openedge` directory of the working directory.
2. If run in docker container mode, the container runtime status can be viewed via the `docker stats` command.
3. To use your own image, you need to modify the **image** of the modules and functions in the application configuration to specify your own image.
4. For custom configuration, follow the instructions in [Configuration Interpretation](../tutorials/Config-interpretation.md) to make the relevant settings.

## Uninstall OpenEdge

If it is the default installation:

```shell
cd $GOPATH/src/github.com/baidu/openedge
make clean # Can be used to clean executable files generated by compilation
make uninstall # Uninstall if you install in docker mode
make uninstall-native # Uninstall if you install in native mode
```

If the installation path is specified, for example, it is installed into the output directory.

```shell
cd $GOPATH/src/github.com/baidu/openedge
make clean # Can be used to clean executable files generated by compilation
make uninstall PREFIX=output # Uninstall if you install in docker mode
make uninstall-native PREFIX=output # Uninstall if you install in native mode
```